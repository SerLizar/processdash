
<project default="jar" basedir=".">

  <target name="filelist.txt">
    <pathconvert property=".filelistbasedir" pathsep="," dirsep="/">
      <path id=".jhbasedir.path" path="Templates/team/setup"/>
    </pathconvert>
    <pathconvert property=".filelist" pathsep="," dirsep="/">
      <path>
        <fileset dir="Templates/team/setup" includes="*.shtm,*.link" excludes="*sizeForm*"/>
      </path>
    </pathconvert>
    <property name="filelist" value="Templates/team/setup/filelist.txt"/>
    <echo message="&lt;!--#set var='Wizard_File_List' value='LIST=,${.filelist},' --&gt;&#13;&#10;" file="${filelist}"/>
    <replace file="${filelist}" token="${.filelistbasedir}/" value=""/>
  </target>

  <target name="jar" depends="filelist.txt">
    <!-- Create a signed jarfile of cgi scripts -->  
    <jar destfile="TeamProcessCGI.jar" duplicate="fail">
      <fileset dir="bin" includes="teamdash/templates/setup/"/>
    </jar>
    <property environment="env"/>
    <signjar jar="TeamProcessCGI.jar" alias="processdash-full-permissions"
	storepass="${env.TDKSPW}"/>

    <jar destfile="TeamTools.jar" duplicate="fail">
      <!-- specify the manifest file contents -->
      <manifest>
        <attribute name="Main-Class" value="teamdash.wbs.WBSEditor"/>
	<attribute name="Dash-Pkg-ID" value="teamTools"/>
	<attribute name="Dash-Pkg-Version" value="1.9.0"/>
	<attribute name="Dash-Pkg-Name" value="Advanced Team Tools"/>
	<attribute name="Dash-Pkg-URL"
	           value="http://processdash.sourceforge.net/cgi-bin/update"/>
      </manifest>

      <!-- include the compiled files -->
      <fileset dir="bin">
        <include name="teamdash/**/*.class"/>
        <include name="teamdash/**/*.png"/>
        <include name="teamdash/**/*.gif"/>
        <exclude name="teamdash/templates/setup/"/>
      </fileset>

      <!-- include the templates -->
      <fileset dir=".">
        <include name="Templates/team/lib/" />
        <exclude name="Templates/team/lib/todo.txt" />
        <include name="Templates/team/tools/*.link" />
        <include name="Templates/team/tools/*.shtm" />
        <include name="Templates/team/setup/*.link" />
        <include name="Templates/team/setup/*.shtm" />
        <include name="Templates/team/setup/filelist.txt" />
      </fileset>

      <!-- include the signed jarfile of cgi scripts -->
      <zipfileset dir="." includes="TeamProcessCGI.jar"
          fullpath="Templates/team/lib/TeamProcessCGI.jar"/>

    </jar>

    <signjar jar="TeamTools.jar" alias="processdash-full-permissions"
	storepass="${env.TDKSPW}"/>
  </target>

</project>